name: Notify on PR Merge to Main

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Simulate build or run actual steps
        run: echo "Replace with your actual build/test/deploy steps"

  notify:
    needs: build
    runs-on: ubuntu-latest
    if: always()  # Run regardless of success/failure
    steps:
      - name: Send email notification
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_NAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "GitHub Action - Merge to Main - ${{ job.status }}"
          to: |
            lavu2018hani@gmail.com,
            lavu2016hani@gmail.com
          from: GitHub Actions <${{ secrets.MAIL_USERNAME }}>
          content_type: text/html
          body: |
            <table width="100%" cellspacing="0" cellpadding="0" style="font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f4f8; padding: 20px;">
              <tr>
                <td>
                  <table width="600" align="center" cellspacing="0" cellpadding="20" style="background-color: #ffffff; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
                    <tr>
                      <td>
                        <h2 style="margin-top: 0; color: #0b5394;">ğŸš€ GitHub CI/CD Notification</h2>
                        <p style="font-size: 16px;"><strong>ğŸ“Œ Event:</strong> <span style="color: #333;">Pull Request merged to <code style="background-color: #eee; padding: 2px 6px; border-radius: 4px;">main</code></span></p>

                        <hr style="border: 0; height: 1px; background-color: #ddd;" />

                        <p style="font-size: 16px;"><strong>ğŸ“ Repository:</strong> <a href="https://github.com/${{ github.repository }}" style="color: #0b5394;">${{ github.repository }}</a></p>
                        <p style="font-size: 16px;"><strong>ğŸ”— Commit:</strong> <a href="https://github.com/${{ github.repository }}/commit/${{ github.sha }}" style="color: #0b5394;">${{ github.sha }}</a></p>
                        <p style="font-size: 16px;"><strong>ğŸ‘¤ Triggered By:</strong> <span style="color: #333;">${{ github.actor }}</span></p>
                        <p style="font-size: 16px;"><strong>ğŸ“… Timestamp:</strong> <span style="color: #333;">${{ github.event.head_commit.timestamp }}</span></p>
                        <p style="font-size: 16px;"><strong>ğŸ“„ Commit Message:</strong> <em style="color: #444;">${{ github.event.head_commit.message }}</em></p>

                        <hr style="border: 0; height: 1px; background-color: #ddd;" />

                        <h3 style="color: ${{ job.status == 'success' && '#28a745' || '#dc3545' }};">ğŸ¯ Workflow Status: ${{ job.status | upper }}</h3>

                        <p style="font-size: 16px;">ğŸ” <a href="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}" style="color: #0b5394;">Click here to view full workflow logs</a></p>

                        <p style="font-size: 12px; color: #888888; padding-top: 20px;">
                          This is an automated message from your GitHub Actions CI/CD pipeline.
                        </p>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
