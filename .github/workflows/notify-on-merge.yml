name: Notify on PR Merge to Main

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Simulate build or run actual steps
        run: echo "Replace with your actual build/test/deploy steps"

  notify:
    needs: build
    runs-on: ubuntu-latest
    if: always()  # Run regardless of success/failure
    steps:
      - name: Send email notification
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_NAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "GitHub Action - Merge to Main - ${{ job.status }}"
          to: |
            lavu2018hani@gmail.com,
            lavu2016hani@gmail.com
          from: GitHub Actions <${{ secrets.MAIL_USERNAME }}>
          content_type: text/html
          body: |
            <div style="font-family: Arial, sans-serif; padding: 20px; background-color: #f9f9f9;">
              <h2 style="color: #4CAF50;">âœ… GitHub Action Notification</h2>
              <p><strong>ğŸ“Œ Event:</strong> Pull Request <strong>merged</strong> to <code>main</code> branch</p>

              <hr style="border: none; border-top: 1px solid #ccc;" />

              <p><strong>ğŸ“ Repository:</strong> <a href="https://github.com/${{ github.repository }}" target="_blank">${{ github.repository }}</a></p>
              <p><strong>ğŸ”— Commit:</strong> <a href="https://github.com/${{ github.repository }}/commit/${{ github.sha }}" target="_blank">${{ github.sha }}</a></p>
              <p><strong>ğŸ‘¤ Triggered By:</strong> ${{ github.actor }}</p>
              <p><strong>ğŸ“… Timestamp:</strong> ${{ github.event.head_commit.timestamp }}</p>
              <p><strong>ğŸ“„ Commit Message:</strong> ${{ github.event.head_commit.message }}</p>

              <hr style="border: none; border-top: 1px solid #ccc;" />

              <h3 style="color: ${{ job.status == 'success' && '#4CAF50' || '#F44336' }};">
                ğŸš€ Workflow Status: ${{ job.status }}
              </h3>

              <p>Visit the <a href="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}" target="_blank">workflow run page</a> for full details.</p>

              <br />
              <footer style="font-size: 12px; color: #999;">
                This is an automated message from GitHub Actions ğŸš€
              </footer>
            </div>
